import{s as gt,e as xt,c as Ct,b as vt,f as st,m as Q,i as Et,X as St,n as ot,Y as Pt,q as bt,k as X,J as f}from"./scheduler.B6iofcAQ.js";import{S as mt,i as pt,b as kt,d as Rt,m as _t,a as Tt,t as Mt,e as jt}from"./index.DcOQwsS0.js";import{_ as It}from"./preload-helper.C1FmrZbK.js";import{b as wt}from"./paths.C_jsvLeY.js";import{b as it,c as J,r as K,p as $,f as at,w as H,a as V,d as ct,e as W,g as q,i as ut,h as Bt,s as Ot,j as At,k as lt}from"./stores.HNDzHde5.js";import{c as Y}from"./constants.lH_TAHWR.js";function Nt(e){let o,s,i;return{c(){o=xt("div"),this.h()},l(c){o=Ct(c,"DIV",{style:!0,class:!0}),vt(o).forEach(st),this.h()},h(){Q(o,"style",e[0]),Q(o,"class","m-0")},m(c,b){Et(c,o,b),s||(i=St(e[1].call(null,o)),s=!0)},p(c,[b]){b&1&&Q(o,"style",c[0])},i:ot,o:ot,d(c){c&&st(o),s=!1,i()}}}function Ft(e,o){return o.forEach(([s,i])=>e[s]=i),e}function Lt(e,o,s){let{target:i=void 0}=o,{sketch:c=void 0}=o,{parentDivStyle:b="display: block;"}=o,{debug:B=!1}=o,D;const F=Pt(),O={ref(){F("ref",i)},instance(){F("instance",D)}};function A(r){return s(2,i=r),{destroy(){s(2,i=void 0)}}}return bt(async()=>{const r=await It(()=>import("./p5.min.D8xqWc_1.js").then(n=>n.p),[],import.meta.url),{default:m}=r,t=Object.entries(r).filter(([n,d])=>d instanceof Function&&n[0]!=="_"&&n!=="default");B&&console.log("available p5 native classes",t),D=new m(n=>(n=Ft(n,t),B&&console.log("p5 instance",n),window._p5Instance=n,c(n)),i),O.ref(),O.instance()}),e.$$set=r=>{"target"in r&&s(2,i=r.target),"sketch"in r&&s(3,c=r.sketch),"parentDivStyle"in r&&s(0,b=r.parentDivStyle),"debug"in r&&s(4,B=r.debug)},[b,A,i,c,B]}class Ut extends mt{constructor(o){super(),pt(this,o,Lt,Nt,gt,{target:2,sketch:3,parentDivStyle:0,debug:4})}}function Dt(e){let o,s;return o=new Ut({props:{sketch:e[0]}}),{c(){kt(o.$$.fragment)},l(i){Rt(o.$$.fragment,i)},m(i,c){_t(o,i,c),s=!0},p:ot,i(i){s||(Tt(o.$$.fragment,i),s=!0)},o(i){Mt(o.$$.fragment,i),s=!1},d(i){jt(o,i)}}}function ft(e,o){const s=e.x-o.x,i=e.y-o.y;return s*s+i*i}function zt(e,o,s){let i,c,b;X(e,it,t=>s(1,i=t)),X(e,J,t=>s(2,c=t)),X(e,K,t=>s(3,b=t));let B;const D=t=>{t.preload=()=>{B=t.loadFont(wt+"/font/CircularStd-Book.otf",()=>{at.set(!0)})},t.setup=()=>{t.createCanvas(f(H),f(V)),t.colorMode(t.HSL),t.background(0),t.frameRate(30),f(ct).length>0&&(F(),O())},t.draw=()=>{t.background(0,.1);const n=f(W),d=f(q),a=f(ut),l=f(it),u=f(J),x=u.highlightedEntities||f(Bt),g=u.stroke||f(Ot),p=f(at),y=u.speed||f(At),C=f(lt),v=f(K),k=Math.max(...Object.values(C));f($)&&(F(),O(),$.set(!1)),m(t,n,C,k,a,x,u,g,y,l);const j={highlighted:[],normal:[]};Object.values(n).forEach(h=>{if(h.isStationary)return;x.length===0||x.includes(h.moveBy)?j.highlighted.push(h):j.normal.push(h)}),j.highlighted.length>0&&j.highlighted.forEach(h=>{A(t,h,!0,a,l,y,g,u,x)}),j.normal.length>0&&j.normal.forEach(h=>{A(t,h,!1,a,l,y,g,u,x)}),p&&M(t,d,a,u,v)}};function F(){const t=new Map,n={},d=f(J);f(ct).forEach(a=>{const l=a[d.moveBy],u=a[d.clusterBy];n[l]||(n[l]={categories:[],moveBy:l,dataPoints:[],currentCategoryIndex:0,position:{x:0,y:0},t:0,isStationary:!0,trail:[],loopsCompleted:0,loopsToComplete:d.loops||1}),n[l].dataPoints.push(a),n[l].categories.push(u),u!==n[l].categories[0]&&(n[l].isStationary=!1),t.has(u)||t.set(u,[]),t.get(u).push(a)}),W.set(n),q.set(Array.from(t.entries()).sort(([a],[l])=>!isNaN(a)&&!isNaN(l)?+a-+l:a.localeCompare(l)))}function O(){const n=(f(H)-100)/2,d=(f(V)-50*2)/2,a={},l=f(q).length,u=Math.PI;f(q).forEach(([p],y)=>{const C=u+y/l*Math.PI*2,v=f(K)?{x:50+Math.random()*(f(H)-2*50),y:50+Math.random()*(f(V)-2*50)}:{x:f(H)/2+n*Math.cos(C),y:f(V)/2+d*Math.sin(C)};a[p]={x:v.x,y:v.y}}),ut.set(a);const x=f(W),g={};Object.values(x).forEach(p=>{const y=p.categories[0];a[y]&&(p.position={...a[y]},p.t=0,p.currentCategoryIndex=0,p.isStationary&&(g[y]||(g[y]=0),g[y]++))}),W.set(x),lt.set(g)}function A(t,n,d,a,l,u,x,g,p){if(n.isStationary)return;const y=p.length===0||d,C=Y[g.clusterBy]||{start:[0,0,100],end:[0,0,0]},v=n.categories,k=n.currentCategoryIndex,j=n.position;let h=n.t||0;const E=v[k%v.length],R=v[(k+1)%v.length],S=a[E],_=a[R];if(S&&_){const L=r(t,n,C,h,n.isGoingBack);t.stroke(y?[...L]:[0,0,40]),t.strokeWeight(y?x:.5),t.noFill(),t.strokeJoin(t.ROUND);let T={x:0,y:0};if(l){const U={x:S.x-12.5,y:S.y-12.5},rt={x:_.x+25/2,y:_.y+25/2};T.x=t.bezierPoint(S.x,U.x-25,rt.x-25,_.x,h),T.y=t.bezierPoint(S.y,U.y+25,rt.y+25,_.y,h)}else T.x=t.lerp(S.x,_.x,h),T.y=t.lerp(S.y,_.y,h);const I=n.trail||[],Z=I[I.length-1],N=1;(!Z||ft(Z,T)>=N*N)&&(I.length>=2&&I.shift(),I.push({x:T.x,y:T.y}));const w=.004*u;h+=w,h>1&&(h=0,n.currentCategoryIndex=(k+1)%v.length,n.currentCategoryIndex===0?(n.loopsCompleted+=1,n.isGoingBack=!0):n.isGoingBack=!1),n.t=h,j.x=T.x,j.y=T.y,t.beginShape();for(let z=0;z<I.length;z++){const U=I[z];t.vertex(U.x,U.y)}t.endShape()}}function r(t,n,d,a,l){var u;return l?d.end:d.start,l?d.start:d.end,(u=Y[f(J).clusterBy])==null?void 0:u.start}function m(t,n,d,a,l,u,x,g,p,y){const C=.004*p;m.trails||(m.trails={});const v=m.trails;Object.keys(d).forEach(k=>{const j=d[k],h=l[k];if(h){v[k]||(v[k]={t:0,trail:[],isGoingBack:!1});const E=v[k];E.t+=C,E.t>1&&(E.t=0);const R=25;h.x-R,h.y-R;const S=h,_=E.t;let L={x:0,y:0};if(y){const N={x:h.x-R/2,y:h.y-R/2},w={x:S.x+R/2,y:S.y+R/2};L.x=t.bezierPoint(h.x,N.x-R,w.x-R,S.x,_),L.y=t.bezierPoint(h.y,N.y+R,w.y+R,S.y,_)}else L.x=t.lerp(h.x,S.x,_),L.y=t.lerp(h.y,S.y,_);const T=1,I=E.trail[E.trail.length-1];if((!I||ft(I,L)>=T*T)&&(E.trail.length>=10&&E.trail.shift(),E.trail.push(L)),(u.length===0||u.some(N=>{const w=n[N];return w&&w.categories.includes(k)&&w.isStationary}))&&x.clusterBy){const N=Y[x.clusterBy]||{start:[0,0,100],end:[0,0,0]},w=r(t,null,N,E.t,!1),z=t.map(j,1,a,g,g*5);t.noFill(),t.stroke(...w),t.strokeWeight(z),t.strokeJoin(t.ROUND),t.beginShape(),E.trail.forEach(U=>t.vertex(U.x,U.y)),t.endShape()}}})}function M(t,n,d,a,l){var u;t.fill(...((u=Y[a.clusterBy])==null?void 0:u.start)||[0,0,40]),t.noStroke(),t.textFont(B),n.forEach(([x])=>{const g=d[x];if(g){if(t.push(),l)t.translate(g.x,g.y);else{let p=Math.atan2(g.y-f(V)/2,g.x-f(H)/2);p>Math.PI/2||p<-Math.PI/2?(p+=Math.PI,t.textAlign(t.RIGHT,t.BOTTOM)):t.textAlign(t.LEFT,t.TOP),t.translate(g.x,g.y),t.rotate(p)}t.textSize(14),t.text(x,0,0),t.pop()}})}return e.$$.update=()=>{e.$$.dirty&14&&(c.clusterBy||c.moveBy||b||c.speed||i)&&(F(),O(),$.set(!1))},[D,i,c,b]}class oe extends mt{constructor(o){super(),pt(this,o,zt,Dt,gt,{})}}var ht={},tt={},et=34,G=10,nt=13;function yt(e){return new Function("d","return {"+e.map(function(o,s){return JSON.stringify(o)+": d["+s+'] || ""'}).join(",")+"}")}function Ht(e,o){var s=yt(e);return function(i,c){return o(s(i),c,e)}}function dt(e){var o=Object.create(null),s=[];return e.forEach(function(i){for(var c in i)c in o||s.push(o[c]=c)}),s}function P(e,o){var s=e+"",i=s.length;return i<o?new Array(o-i+1).join(0)+s:s}function Vt(e){return e<0?"-"+P(-e,6):e>9999?"+"+P(e,6):P(e,4)}function Gt(e){var o=e.getUTCHours(),s=e.getUTCMinutes(),i=e.getUTCSeconds(),c=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Vt(e.getUTCFullYear())+"-"+P(e.getUTCMonth()+1,2)+"-"+P(e.getUTCDate(),2)+(c?"T"+P(o,2)+":"+P(s,2)+":"+P(i,2)+"."+P(c,3)+"Z":i?"T"+P(o,2)+":"+P(s,2)+":"+P(i,2)+"Z":s||o?"T"+P(o,2)+":"+P(s,2)+"Z":"")}function Jt(e){var o=new RegExp('["'+e+`
\r]`),s=e.charCodeAt(0);function i(r,m){var M,t,n=c(r,function(d,a){if(M)return M(d,a-1);t=d,M=m?Ht(d,m):yt(d)});return n.columns=t||[],n}function c(r,m){var M=[],t=r.length,n=0,d=0,a,l=t<=0,u=!1;r.charCodeAt(t-1)===G&&--t,r.charCodeAt(t-1)===nt&&--t;function x(){if(l)return tt;if(u)return u=!1,ht;var p,y=n,C;if(r.charCodeAt(y)===et){for(;n++<t&&r.charCodeAt(n)!==et||r.charCodeAt(++n)===et;);return(p=n)>=t?l=!0:(C=r.charCodeAt(n++))===G?u=!0:C===nt&&(u=!0,r.charCodeAt(n)===G&&++n),r.slice(y+1,p-1).replace(/""/g,'"')}for(;n<t;){if((C=r.charCodeAt(p=n++))===G)u=!0;else if(C===nt)u=!0,r.charCodeAt(n)===G&&++n;else if(C!==s)continue;return r.slice(y,p)}return l=!0,r.slice(y,t)}for(;(a=x())!==tt;){for(var g=[];a!==ht&&a!==tt;)g.push(a),a=x();m&&(g=m(g,d++))==null||M.push(g)}return M}function b(r,m){return r.map(function(M){return m.map(function(t){return A(M[t])}).join(e)})}function B(r,m){return m==null&&(m=dt(r)),[m.map(A).join(e)].concat(b(r,m)).join(`
`)}function D(r,m){return m==null&&(m=dt(r)),b(r,m).join(`
`)}function F(r){return r.map(O).join(`
`)}function O(r){return r.map(A).join(e)}function A(r){return r==null?"":r instanceof Date?Gt(r):o.test(r+="")?'"'+r.replace(/"/g,'""')+'"':r}return{parse:i,parseRows:c,format:B,formatBody:D,formatRows:F,formatRow:O,formatValue:A}}var Wt=Jt("	"),qt=Wt.parse;function Yt(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function Zt(e,o){return fetch(e,o).then(Yt)}function Qt(e){return function(o,s,i){return arguments.length===2&&typeof s=="function"&&(i=s,s=void 0),Zt(o,s).then(function(c){return e(c,i)})}}var re=Qt(qt);export{oe as S,re as t};
