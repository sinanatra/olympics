import{s as dt,e as Ct,c as xt,b as vt,f as st,m as Y,i as Et,W as St,n as nt,X as kt,q as bt,k as Q,I as f}from"./scheduler.evRM0l9T.js";import{S as mt,i as pt,b as _t,d as Pt,m as Rt,a as Tt,t as It,e as Mt}from"./index.aiZKxZDj.js";import{_ as Bt}from"./preload-helper.C1FmrZbK.js";import{b as wt}from"./paths.CVTNpBiD.js";import{f as it,c as z,r as X,p as K,g as at,w as D,a as H,d as ct,e as V,b as W,i as ut,h as jt,s as Lt,j as Ot,k as lt}from"./stores.0UUoU4mb.js";import{c as q}from"./constants.nl2QH9fV.js";function At(e){let o,s,i;return{c(){o=Ct("div"),this.h()},l(c){o=xt(c,"DIV",{style:!0,class:!0}),vt(o).forEach(st),this.h()},h(){Y(o,"style",e[0]),Y(o,"class","m-0")},m(c,k){Et(c,o,k),s||(i=St(e[1].call(null,o)),s=!0)},p(c,[k]){k&1&&Y(o,"style",c[0])},i:nt,o:nt,d(c){c&&st(o),s=!1,i()}}}function Nt(e,o){return o.forEach(([s,i])=>e[s]=i),e}function Ft(e,o,s){let{target:i=void 0}=o,{sketch:c=void 0}=o,{parentDivStyle:k="display: block;"}=o,{debug:w=!1}=o,N;const O=kt(),j={ref(){O("ref",i)},instance(){O("instance",N)}};function L(r){return s(2,i=r),{destroy(){s(2,i=void 0)}}}return bt(async()=>{const r=await Bt(()=>import("./p5.min.D8xqWc_1.js").then(n=>n.p),[],import.meta.url),{default:m}=r,t=Object.entries(r).filter(([n,h])=>h instanceof Function&&n[0]!=="_"&&n!=="default");w&&console.log("available p5 native classes",t),N=new m(n=>(n=Nt(n,t),w&&console.log("p5 instance",n),window._p5Instance=n,c(n)),i),j.ref(),j.instance()}),e.$$set=r=>{"target"in r&&s(2,i=r.target),"sketch"in r&&s(3,c=r.sketch),"parentDivStyle"in r&&s(0,k=r.parentDivStyle),"debug"in r&&s(4,w=r.debug)},[k,L,i,c,w]}class Ut extends mt{constructor(o){super(),pt(this,o,Ft,At,dt,{target:2,sketch:3,parentDivStyle:0,debug:4})}}function Dt(e){let o,s;return o=new Ut({props:{sketch:e[0]}}),{c(){_t(o.$$.fragment)},l(i){Pt(o.$$.fragment,i)},m(i,c){Rt(o,i,c),s=!0},p:nt,i(i){s||(Tt(o.$$.fragment,i),s=!0)},o(i){It(o.$$.fragment,i),s=!1},d(i){Mt(o,i)}}}function ft(e,o){const s=e.x-o.x,i=e.y-o.y;return s*s+i*i}function Ht(e,o,s){let i,c,k;Q(e,it,t=>s(1,i=t)),Q(e,z,t=>s(2,c=t)),Q(e,X,t=>s(3,k=t));let w;const N=t=>{t.preload=()=>{w=t.loadFont(wt+"/font/CircularStd-Book.otf",()=>{at.set(!0)})},t.setup=()=>{t.createCanvas(f(D),f(H)),t.colorMode(t.HSL),t.background(0),t.frameRate(60),f(ct).length>0&&(O(),j())},t.draw=()=>{t.background(0,.1);const n=f(V),h=f(W),a=f(ut),l=f(it),u=f(z),y=u.highlightedEntities||f(jt),g=u.stroke||f(Lt),d=f(at),p=u.speed||f(Ot),x=f(lt),C=f(X);f(K)&&(O(),j(),K.set(!1)),m(t,n,x,a,y,u,g,p);const b={highlighted:[],normal:[]};Object.values(n).forEach(E=>{if(E.isStationary)return;y.length===0||y.includes(E.moveBy)?b.highlighted.push(E):b.normal.push(E)}),b.highlighted.length>0&&b.highlighted.forEach(E=>{L(t,E,!0,a,l,p,g,u,y)}),b.normal.length>0&&b.normal.forEach(E=>{L(t,E,!1,a,l,p,g,u,y)}),d&&_(t,h,a,u,C)}};function O(){const t=new Map,n={},h=f(z);f(ct).forEach(a=>{const l=a[h.moveBy],u=a[h.clusterBy];n[l]||(n[l]={categories:[],moveBy:l,dataPoints:[],currentCategoryIndex:0,position:{x:0,y:0},t:0,isStationary:!0,trail:[],loopsCompleted:0,loopsToComplete:h.loops||1}),n[l].dataPoints.push(a),n[l].categories.push(u),u!==n[l].categories[0]&&(n[l].isStationary=!1),t.has(u)||t.set(u,[]),t.get(u).push(a)}),V.set(n),W.set(Array.from(t.entries()).sort(([a],[l])=>!isNaN(a)&&!isNaN(l)?+a-+l:a.localeCompare(l)))}function j(){const n=(f(D)-100)/2,h=(f(H)-50*2)/2,a={},l=f(W).length,u=Math.PI;f(W).forEach(([d],p)=>{const x=u+p/l*Math.PI*2,C=f(X)?{x:50+Math.random()*(f(D)-2*50),y:50+Math.random()*(f(H)-2*50)}:{x:f(D)/2+n*Math.cos(x),y:f(H)/2+h*Math.sin(x)};a[d]={x:C.x,y:C.y}}),ut.set(a);const y=f(V),g={};Object.values(y).forEach(d=>{const p=d.categories[0];a[p]&&(d.position={...a[p]},d.t=0,d.currentCategoryIndex=0,d.isStationary&&(g[p]||(g[p]=0),g[p]++))}),V.set(y),lt.set(g)}function L(t,n,h,a,l,u,y,g,d){if(n.isStationary)return;const p=d.length===0||h,x=q[g.clusterBy]||{start:[0,0,100],end:[0,0,0]},C=n.categories,b=n.currentCategoryIndex,E=n.position;let P=n.t||0;const ot=C[b%C.length],v=C[(b+1)%C.length],T=a[ot],I=a[v];if(T&&I){const J=r(t,n,x,P,n.isGoingBack);t.stroke(p?[...J]:[0,0,40]),t.strokeWeight(p?y:1),t.noFill(),t.strokeJoin(t.ROUND);let R={x:0,y:0};if(l){const A={x:T.x-25,y:T.y-25},rt={x:I.x+50/2,y:I.y+50/2};R.x=t.bezierPoint(T.x,A.x-50,rt.x-50,I.x,P),R.y=t.bezierPoint(T.y,A.y+50,rt.y+50,I.y,P)}else R.x=t.lerp(T.x,I.x,P),R.y=t.lerp(T.y,I.y,P);const M=n.trail||[],F=M[M.length-1],Z=1;(!F||ft(F,R)>=Z*Z)&&(M.length>=4&&M.shift(),M.push({x:R.x,y:R.y}));const U=.004*u;P+=U,P>1&&(P=0,n.currentCategoryIndex=(b+1)%C.length,n.currentCategoryIndex===0?(n.loopsCompleted+=1,n.isGoingBack=!0):n.isGoingBack=!1),n.t=P,E.x=R.x,E.y=R.y,t.beginShape();for(let B=0;B<M.length;B++){const A=M[B];t.vertex(A.x,A.y)}t.endShape()}}function r(t,n,h,a,l){var u;return l?h.end:h.start,l?h.start:h.end,(u=q[f(z).clusterBy])==null?void 0:u.start}function m(t,n,h,a,l,u,y,g){const d=h,p=.004*g;m.trails||(m.trails={});const x=m.trails;Object.keys(d).forEach(C=>{const b=d[C],E=a[C];if(E){x[C]||(x[C]={t:Math.random(),trail:[],isGoingBack:!1});const v=x[C];v.t+=p,v.t>1&&(v.t=0,v.isGoingBack=!v.isGoingBack);const T=v.t*t.TWO_PI,I=2+Math.sqrt(b),J=E.x+I*t.cos(T),R=E.y+I*t.sin(T),M={x:J,y:R},F=v.trail[v.trail.length-1];if((!F||ft(F,M)>=2*2)&&(v.trail.length>=4&&v.trail.shift(),v.trail.push(M)),(l.length===0||l.some(U=>{const B=n[U];return B&&B.categories.includes(C)&&B.isStationary}))&&u.clusterBy){const U=q[u.clusterBy]||{start:[0,0,100],end:[0,0,0]},B=r(t,null,U,v.t,v.isGoingBack);t.noFill(),t.stroke(...B),t.strokeWeight(y),t.strokeJoin(t.ROUND),t.beginShape(),v.trail.forEach(A=>t.vertex(A.x,A.y)),t.endShape()}}})}function _(t,n,h,a,l){var u;t.fill(...((u=q[a.clusterBy])==null?void 0:u.start)||[0,0,40]),t.noStroke(),t.textFont(w),n.forEach(([y])=>{const g=h[y];if(g){if(t.push(),l)t.translate(g.x,g.y);else{let d=Math.atan2(g.y-f(H)/2,g.x-f(D)/2);d>Math.PI/2||d<-Math.PI/2?(d+=Math.PI,t.textAlign(t.RIGHT,t.BOTTOM)):t.textAlign(t.LEFT,t.TOP),t.translate(g.x,g.y),t.rotate(d)}t.textSize(14),t.text(y,0,0),t.pop()}})}return e.$$.update=()=>{e.$$.dirty&14&&(c.clusterBy||c.moveBy||k||c.speed||i)&&(O(),j(),K.set(!1))},[N,i,c,k]}class oe extends mt{constructor(o){super(),pt(this,o,Ht,Dt,dt,{})}}var ht={},$={},tt=34,G=10,et=13;function yt(e){return new Function("d","return {"+e.map(function(o,s){return JSON.stringify(o)+": d["+s+'] || ""'}).join(",")+"}")}function Gt(e,o){var s=yt(e);return function(i,c){return o(s(i),c,e)}}function gt(e){var o=Object.create(null),s=[];return e.forEach(function(i){for(var c in i)c in o||s.push(o[c]=c)}),s}function S(e,o){var s=e+"",i=s.length;return i<o?new Array(o-i+1).join(0)+s:s}function zt(e){return e<0?"-"+S(-e,6):e>9999?"+"+S(e,6):S(e,4)}function Vt(e){var o=e.getUTCHours(),s=e.getUTCMinutes(),i=e.getUTCSeconds(),c=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":zt(e.getUTCFullYear())+"-"+S(e.getUTCMonth()+1,2)+"-"+S(e.getUTCDate(),2)+(c?"T"+S(o,2)+":"+S(s,2)+":"+S(i,2)+"."+S(c,3)+"Z":i?"T"+S(o,2)+":"+S(s,2)+":"+S(i,2)+"Z":s||o?"T"+S(o,2)+":"+S(s,2)+"Z":"")}function Wt(e){var o=new RegExp('["'+e+`
\r]`),s=e.charCodeAt(0);function i(r,m){var _,t,n=c(r,function(h,a){if(_)return _(h,a-1);t=h,_=m?Gt(h,m):yt(h)});return n.columns=t||[],n}function c(r,m){var _=[],t=r.length,n=0,h=0,a,l=t<=0,u=!1;r.charCodeAt(t-1)===G&&--t,r.charCodeAt(t-1)===et&&--t;function y(){if(l)return $;if(u)return u=!1,ht;var d,p=n,x;if(r.charCodeAt(p)===tt){for(;n++<t&&r.charCodeAt(n)!==tt||r.charCodeAt(++n)===tt;);return(d=n)>=t?l=!0:(x=r.charCodeAt(n++))===G?u=!0:x===et&&(u=!0,r.charCodeAt(n)===G&&++n),r.slice(p+1,d-1).replace(/""/g,'"')}for(;n<t;){if((x=r.charCodeAt(d=n++))===G)u=!0;else if(x===et)u=!0,r.charCodeAt(n)===G&&++n;else if(x!==s)continue;return r.slice(p,d)}return l=!0,r.slice(p,t)}for(;(a=y())!==$;){for(var g=[];a!==ht&&a!==$;)g.push(a),a=y();m&&(g=m(g,h++))==null||_.push(g)}return _}function k(r,m){return r.map(function(_){return m.map(function(t){return L(_[t])}).join(e)})}function w(r,m){return m==null&&(m=gt(r)),[m.map(L).join(e)].concat(k(r,m)).join(`
`)}function N(r,m){return m==null&&(m=gt(r)),k(r,m).join(`
`)}function O(r){return r.map(j).join(`
`)}function j(r){return r.map(L).join(e)}function L(r){return r==null?"":r instanceof Date?Vt(r):o.test(r+="")?'"'+r.replace(/"/g,'""')+'"':r}return{parse:i,parseRows:c,format:w,formatBody:N,formatRows:O,formatRow:j,formatValue:L}}var qt=Wt("	"),Jt=qt.parse;function Zt(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function Yt(e,o){return fetch(e,o).then(Zt)}function Qt(e){return function(o,s,i){return arguments.length===2&&typeof s=="function"&&(i=s,s=void 0),Yt(o,s).then(function(c){return e(c,i)})}}var re=Qt(Jt);export{oe as S,re as t};
