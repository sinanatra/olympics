const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/RecordRTC.Bv7qv1Kq.js","../chunks/_commonjsHelpers.Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{s as gt,e as A,t as I,a as P,c as T,b as N,d as U,f as R,g as D,i as Q,h as c,u as $,n as K,w as mt,k as tt,y as it,p as ct,q as Rt,m as _t,o as F,j as yt,x as dt}from"../chunks/scheduler.C4GZKIzL.js";import{S as bt,i as vt,a as z,c as wt,t as G,g as St,b as X,d as Y,m as Z,f as x}from"../chunks/index.DmHFZWEd.js";import{b as kt}from"../chunks/paths.pY9r1nP_.js";import{s as J,g as At,b as H,f as Tt,a as ht,d as ut,w as Et,h as Ct}from"../chunks/stores.DNmsBm8e.js";import{m as ft,t as Nt,S as Bt}from"../chunks/dsv.D2pUrWns.js";import{C as Ot}from"../chunks/ControlPanel.CSm7CS3W.js";import{_ as Mt}from"../chunks/preload-helper.C1FmrZbK.js";import{c as pt}from"../chunks/constants.CgZt1VnM.js";const Pt=async({fetch:n})=>({posts:await(await n("/api/snippets")).json()}),Xt=Object.freeze(Object.defineProperty({__proto__:null,load:Pt},Symbol.toStringTag,{value:"Module"}));function Dt(n){let t,e,a,p,i,o,m,s,g,f,y,E,w,S,_,d,u,b;return{c(){t=A("div"),e=A("button"),a=I("Start Manual Recording"),i=P(),o=A("button"),m=I("Stop Manual Recording"),g=P(),f=A("button"),y=I("Start Auto-Recording"),w=P(),S=A("button"),_=I("Start Advanced Auto-Recording"),this.h()},l(r){t=T(r,"DIV",{});var l=N(t);e=T(l,"BUTTON",{});var v=N(e);a=U(v,"Start Manual Recording"),v.forEach(R),i=D(l),o=T(l,"BUTTON",{});var k=N(o);m=U(k,"Stop Manual Recording"),k.forEach(R),g=D(l),f=T(l,"BUTTON",{});var O=N(f);y=U(O,"Start Auto-Recording"),O.forEach(R),w=D(l),S=T(l,"BUTTON",{});var B=N(S);_=U(B,"Start Advanced Auto-Recording"),B.forEach(R),l.forEach(R),this.h()},h(){e.disabled=p=n[0]||n[1]||n[2],o.disabled=s=!n[0]||n[1]||n[2],f.disabled=E=n[1]||n[2],S.disabled=d=n[2]||n[1]},m(r,l){Q(r,t,l),c(t,e),c(e,a),c(t,i),c(t,o),c(o,m),c(t,g),c(t,f),c(f,y),c(t,w),c(t,S),c(S,_),u||(b=[$(e,"click",n[3]),$(o,"click",n[4]),$(f,"click",n[5]),$(S,"click",n[6])],u=!0)},p(r,[l]){l&7&&p!==(p=r[0]||r[1]||r[2])&&(e.disabled=p),l&7&&s!==(s=!r[0]||r[1]||r[2])&&(o.disabled=s),l&6&&E!==(E=r[1]||r[2])&&(f.disabled=E),l&6&&d!==(d=r[2]||r[1])&&(S.disabled=d)},i:K,o:K,d(r){r&&R(t),u=!1,mt(b)}}}const It=2e4;function Ut(n,t,e){let a;tt(n,J,d=>e(7,a=d));let p,i=!1,o=!1,m=!1,s=0,g;async function f(){const d=it(At);if(d){const{default:u}=await Mt(async()=>{const{default:r}=await import("../chunks/RecordRTC.Bv7qv1Kq.js").then(l=>l.R);return{default:r}},__vite__mapDeps([0,1]),import.meta.url),b=d.captureStream(30);p=new u(b,{type:"video",mimeType:"video/webm",videoBitsPerSecond:15e6}),p.startRecording(),e(0,i=!0),console.log("Recording started")}else console.error("Canvas not found")}async function y(){p&&i?(p.stopRecording(()=>{const d=p.getBlob(),u=document.createElement("a");u.href=URL.createObjectURL(d),u.download="canvas_recording.webm",u.click(),console.log("Recording stopped and saved")}),e(0,i=!1)):console.error("No active recording")}function E(){if(o)return;e(1,o=!0);const d=Object.keys(pt).filter(u=>u!=="name");console.log("Auto-recording started"),i||f(),setInterval(()=>{if(s>=d.length){console.log("All steps completed. Stopping auto-recording."),w();return}const u=d[s];H.update(b=>({...b,clusterBy:u})),console.log(`Updated clusterBy to: ${u}`),s++},It)}async function w(){o&&(clearInterval(g),e(1,o=!1),s=0,await y(),console.log("Auto-recording stopped"))}async function S(){if(m)return;e(2,m=!0);const d=Object.keys(pt).filter(r=>r!=="name");let u;console.log("Advanced auto-recording started"),i||await f();async function b(r){u=it(Tt);for(const l of u)H.update(v=>({...v,queryValue:"",filters:{}})),ht.set([]),H.update(v=>({...v,clusterBy:r,filters:{[r]:[l[0]]},speed:5})),await new Promise(v=>{ft.subscribe(k=>{k&&(ft.set(!1),v())})})}for(const r of d)if(H.update(l=>({...l,clusterBy:r,filters:{}})),await new Promise(l=>setTimeout(l,2e3)),await b(r),s++,s>=d.length){console.log("All categories and filters completed.");break}await _()}async function _(){m&&(e(2,m=!1),s=0,await y(),console.log("Advanced auto-recording stopped"))}return n.$$.update=()=>{n.$$.dirty&128&&(a==!0?f():y())},[i,o,m,f,y,E,S,a]}class Vt extends bt{constructor(t){super(),vt(this,t,Ut,Dt,gt,{})}}function jt(n){let t,e="...";return{c(){t=A("p"),t.textContent=e,this.h()},l(a){t=T(a,"P",{class:!0,"data-svelte-h":!0}),_t(t)!=="svelte-nvw4vi"&&(t.textContent=e),this.h()},h(){F(t,"class","svelte-wohxbi")},m(a,p){Q(a,t,p)},p:K,i:K,o:K,d(a){a&&R(t)}}}function $t(n){var ot,st;let t,e,a,p,i,o,m,s,g,f,y,E,w,S,_=(((st=(ot=n[0].posts[n[1]])==null?void 0:ot.meta)==null?void 0:st.title)||"No Title")+"",d,u,b,r="",l,v,k,O,B,V,j,W,et;return a=new Bt({}),k=new Vt({}),V=new Ot({}),{c(){t=A("main"),e=A("div"),X(a.$$.fragment),p=P(),i=A("div"),o=A("button"),m=I("Start Recording Stories"),s=P(),g=A("button"),f=I("Stop Recording Stories"),E=P(),w=A("span"),S=I("Current Story: "),d=I(_),u=P(),b=A("spanp"),b.innerHTML=r,l=P(),v=A("div"),X(k.$$.fragment),O=P(),B=A("div"),X(V.$$.fragment),this.h()},l(h){t=T(h,"MAIN",{});var C=N(t);e=T(C,"DIV",{class:!0});var L=N(e);Y(a.$$.fragment,L),L.forEach(R),p=D(C),i=T(C,"DIV",{class:!0});var M=N(i);o=T(M,"BUTTON",{});var nt=N(o);m=U(nt,"Start Recording Stories"),nt.forEach(R),s=D(M),g=T(M,"BUTTON",{});var at=N(g);f=U(at,"Stop Recording Stories"),at.forEach(R),E=D(M),w=T(M,"SPAN",{});var q=N(w);S=U(q,"Current Story: "),d=U(q,_),u=D(q),b=T(q,"SPANP",{"data-svelte-h":!0}),_t(b)!=="svelte-18h7vo"&&(b.innerHTML=r),q.forEach(R),M.forEach(R),l=D(C),v=T(C,"DIV",{class:!0});var rt=N(v);Y(k.$$.fragment,rt),rt.forEach(R),O=D(C),B=T(C,"DIV",{class:!0});var lt=N(B);Y(V.$$.fragment,lt),lt.forEach(R),C.forEach(R),this.h()},h(){F(e,"class","svelte-wohxbi"),o.disabled=n[2],g.disabled=y=!n[2],F(i,"class","svelte-wohxbi"),F(v,"class","svelte-wohxbi"),F(B,"class","svelte-wohxbi")},m(h,C){Q(h,t,C),c(t,e),Z(a,e,null),c(t,p),c(t,i),c(i,o),c(o,m),c(i,s),c(i,g),c(g,f),c(i,E),c(i,w),c(w,S),c(w,d),c(w,u),c(w,b),c(t,l),c(t,v),Z(k,v,null),c(t,O),c(t,B),Z(V,B,null),j=!0,W||(et=[$(o,"click",n[7]),$(g,"click",n[8])],W=!0)},p(h,C){var L,M;(!j||C&4)&&(o.disabled=h[2]),(!j||C&4&&y!==(y=!h[2]))&&(g.disabled=y),(!j||C&3)&&_!==(_=(((M=(L=h[0].posts[h[1]])==null?void 0:L.meta)==null?void 0:M.title)||"No Title")+"")&&yt(d,_)},i(h){j||(G(a.$$.fragment,h),G(k.$$.fragment,h),G(V.$$.fragment,h),j=!0)},o(h){z(a.$$.fragment,h),z(k.$$.fragment,h),z(V.$$.fragment,h),j=!1},d(h){h&&R(t),x(a),x(k),x(V),W=!1,mt(et)}}}function Lt(n){let t,e,a,p;const i=[$t,jt],o=[];function m(s,g){return s[3].length>0?0:1}return t=m(n),e=o[t]=i[t](n),{c(){e.c(),a=ct()},l(s){e.l(s),a=ct()},m(s,g){o[t].m(s,g),Q(s,a,g),p=!0},p(s,[g]){let f=t;t=m(s),t===f?o[t].p(s,g):(St(),z(o[f],1,1,()=>{o[f]=null}),wt(),e=o[t],e?e.p(s,g):(e=o[t]=i[t](s),e.c()),G(e,1),e.m(a.parentNode,a))},i(s){p||(G(e),p=!0)},o(s){z(e),p=!1},d(s){s&&R(a),o[t].d(s)}}}function qt(n,t,e){let a,p;tt(n,J,_=>e(10,a=_)),tt(n,ut,_=>e(3,p=_));let{data:i}=t,o=-1,m=null,s=!1;Rt(async()=>{const d=(await Nt(kt+"/data/update-until-2022/data.tsv")).map(u=>{const b={};for(const[r,l]of Object.entries(u))b[r]=l!=null&&l.trim()?l:"NA";return b});ut.set(d),Et.set(3240),Ct.set(1080)});function g(){s||(e(2,s=!0),dt(J,a=!0,a),console.log("Manual recording started"))}function f(){s&&(e(2,s=!1),dt(J,a=!1,a),console.log("Manual recording stopped"))}function y(){m||(g(),m=setInterval(()=>{var _,d,u,b,r;e(1,o=(o+1)%i.posts.length),H.update(l=>{var v,k,O,B;return{...l,...(k=(v=i.posts[o])==null?void 0:v.meta)==null?void 0:k.config,caption:(B=(O=i.posts[o])==null?void 0:O.meta)==null?void 0:B.caption}}),ht.set(((u=(d=(_=i.posts[o])==null?void 0:_.meta)==null?void 0:d.config)==null?void 0:u.highlightedEntities)||[]),console.log(`Current story: ${(r=(b=i.posts[o])==null?void 0:b.meta)==null?void 0:r.title}`),o===i.posts.length-1&&(E(),f())},6e4))}function E(){m&&(clearInterval(m),m=null)}const w=()=>{y()},S=()=>{E(),f()};return n.$$set=_=>{"data"in _&&e(0,i=_.data)},[i,o,s,p,f,y,E,w,S]}class Yt extends bt{constructor(t){super(),vt(this,t,qt,Lt,gt,{data:0})}}export{Yt as component,Xt as universal};
