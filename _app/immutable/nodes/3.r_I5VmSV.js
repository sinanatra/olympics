import{s as rt,e as v,t as H,a as T,c as m,b as k,d as R,f as _,g as j,l as Be,m as p,i as te,h as a,E as ue,j as oe,n as je,B as De,F as dt,k as Ve,G as ie,r as Ce,I as Ge,q as ft}from"../chunks/scheduler.evRM0l9T.js";import{S as ot,i as it,b as at,d as ct,m as ut,t as Ae,c as gt,a as Te,e as ht,g as _t}from"../chunks/index.aiZKxZDj.js";import{b as pt}from"../chunks/paths.DlU-xwP8.js";import{h as me,c as ye,e as $e,b as vt,d as Je,w as mt,a as yt}from"../chunks/stores.D9mTdjSf.js";import{t as Ct,S as bt}from"../chunks/dsv.CPDqW2mz.js";import{e as re}from"../chunks/each.D6YF6ztN.js";import{f as kt,a as Et}from"../chunks/constants.CA4Cg4R8.js";function We(t,e,l){const n=t.slice();return n[31]=e[l][0],n[32]=e[l][1],n}function Ke(t,e,l){const n=t.slice();return n[35]=e[l],n}function Xe(t,e,l){const n=t.slice();return n[32]=e[l][0],n[38]=e[l][1],n}function Ye(t,e,l){const n=t.slice();return n[35]=e[l],n}function Ze(t){let e,l=t[35]+"",n,c,h,d;function g(){return t[21](t[35])}return{c(){e=v("span"),n=H(l),c=T(),this.h()},l(u){e=m(u,"SPAN",{class:!0});var i=k(e);n=R(i,l),c=j(i),i.forEach(_),this.h()},h(){p(e,"class","svelte-1lx8ury"),ie(e,"selected",t[35]===t[4].clusterBy)},m(u,i){te(u,e,i),a(e,n),a(e,c),h||(d=ue(e,"click",g),h=!0)},p(u,i){t=u,i[0]&128&&l!==(l=t[35]+"")&&oe(n,l),i[0]&144&&ie(e,"selected",t[35]===t[4].clusterBy)},d(u){u&&_(e),h=!1,d()}}}function et(t){let e,l=t[32]+"",n,c,h,d;function g(){return t[22](t[32])}return{c(){e=v("span"),n=H(l),c=T(),this.h()},l(u){e=m(u,"SPAN",{style:!0,class:!0});var i=k(e);n=R(i,l),c=j(i),i.forEach(_),this.h()},h(){Ce(e,"font-size",t[14](t[38])+"px"),p(e,"class","svelte-1lx8ury"),ie(e,"highlighted",t[32]==t[4].selectedClusterValue)},m(u,i){te(u,e,i),a(e,n),a(e,c),h||(d=ue(e,"click",g),h=!0)},p(u,i){t=u,i[0]&2&&l!==(l=t[32]+"")&&oe(n,l),i[0]&2&&Ce(e,"font-size",t[14](t[38])+"px"),i[0]&18&&ie(e,"highlighted",t[32]==t[4].selectedClusterValue)},d(u){u&&_(e),h=!1,d()}}}function tt(t){let e,l=t[35]+"",n,c,h,d;function g(){return t[23](t[35])}return{c(){e=v("span"),n=H(l),c=T(),this.h()},l(u){e=m(u,"SPAN",{class:!0});var i=k(e);n=R(i,l),c=j(i),i.forEach(_),this.h()},h(){p(e,"class","svelte-1lx8ury"),ie(e,"selected",t[35]===t[4].moveBy)},m(u,i){te(u,e,i),a(e,n),a(e,c),h||(d=ue(e,"click",g),h=!0)},p(u,i){t=u,i[0]&64&&l!==(l=t[35]+"")&&oe(n,l),i[0]&80&&ie(e,"selected",t[35]===t[4].moveBy)},d(u){u&&_(e),h=!1,d()}}}function lt(t){let e,l=t[31]+"",n,c,h;function d(){return t[24](t[31])}return{c(){e=v("span"),n=H(l),this.h()},l(g){e=m(g,"SPAN",{style:!0,class:!0});var u=k(e);n=R(u,l),u.forEach(_),this.h()},h(){Ce(e,"font-size",t[13](t[32])+"px"),p(e,"class","svelte-1lx8ury"),ie(e,"highlighted",t[3].includes(t[31]))},m(g,u){te(g,e,u),a(e,n),c||(h=ue(e,"click",d),c=!0)},p(g,u){t=g,u[0]&4&&l!==(l=t[31]+"")&&oe(n,l),u[0]&4&&Ce(e,"font-size",t[13](t[32])+"px"),u[0]&12&&ie(e,"highlighted",t[3].includes(t[31]))},d(g){g&&_(e),c=!1,h()}}}function st(t){let e,l,n=t[2].length+"",c;return{c(){e=v("p"),l=H("50 out of "),c=H(n),this.h()},l(h){e=m(h,"P",{style:!0});var d=k(e);l=R(d,"50 out of "),c=R(d,n),d.forEach(_),this.h()},h(){Ce(e,"border-top","1px solid"),Ce(e,"padding-top","10px")},m(h,d){te(h,e,d),a(e,l),a(e,c)},p(h,d){d[0]&4&&n!==(n=h[2].length+"")&&oe(c,n)},d(h){h&&_(e)}}}function Bt(t){let e,l,n,c,h,d,g,u="Reset",i,N,E="Copy Config",I,C,G,J,le="Cluster By:",y,$,ae,z,W,be,ce=t[4].clusterBy+"",se,he,de,Y,ke,K,Z,Se="Move By:",Ee,ee,o,f,b,M,D=t[4].moveBy+"",B,w,V,S,Q,X,qe,Ne,Qe,fe=re(t[7]),P=[];for(let r=0;r<fe.length;r+=1)P[r]=Ze(Ye(t,fe,r));let ge=re(t[1]),O=[];for(let r=0;r<ge.length;r+=1)O[r]=et(Xe(t,ge,r));let _e=re(t[6]),L=[];for(let r=0;r<_e.length;r+=1)L[r]=tt(Ke(t,_e,r));let pe=re(t[2].slice(0,50).sort(nt)),F=[];for(let r=0;r<pe.length;r+=1)F[r]=lt(We(t,pe,r));let A=t[2].length>50&&st(t);return{c(){e=v("header"),l=v("div"),n=v("div"),c=H(t[5]),h=T(),d=v("div"),g=v("button"),g.textContent=u,i=T(),N=v("button"),N.textContent=E,I=T(),C=v("div"),G=v("div"),J=v("label"),J.textContent=le,y=T(),$=v("div");for(let r=0;r<P.length;r+=1)P[r].c();ae=T(),z=v("div"),W=v("label"),be=H("Filter "),se=H(ce),he=H(":"),de=T(),Y=v("div");for(let r=0;r<O.length;r+=1)O[r].c();ke=T(),K=v("div"),Z=v("label"),Z.textContent=Se,Ee=T(),ee=v("div");for(let r=0;r<L.length;r+=1)L[r].c();o=T(),f=v("div"),b=v("label"),M=H("Filter "),B=H(D),w=H(":"),V=T(),S=v("input"),Q=T(),X=v("div");for(let r=0;r<F.length;r+=1)F[r].c();qe=T(),A&&A.c(),this.h()},l(r){e=m(r,"HEADER",{class:!0});var q=k(e);l=m(q,"DIV",{class:!0});var s=k(l);n=m(s,"DIV",{class:!0});var U=k(n);c=R(U,t[5]),U.forEach(_),h=j(s),d=m(s,"DIV",{class:!0});var Ie=k(d);g=m(Ie,"BUTTON",{class:!0,"data-svelte-h":!0}),Be(g)!=="svelte-qy1k7w"&&(g.textContent=u),i=j(Ie),N=m(Ie,"BUTTON",{class:!0,"data-svelte-h":!0}),Be(N)!=="svelte-i2notl"&&(N.textContent=E),Ie.forEach(_),s.forEach(_),I=j(q),C=m(q,"DIV",{class:!0});var ne=k(C);G=m(ne,"DIV",{class:!0});var we=k(G);J=m(we,"LABEL",{class:!0,"data-svelte-h":!0}),Be(J)!=="svelte-1ekr4iz"&&(J.textContent=le),y=j(we),$=m(we,"DIV",{class:!0});var Ue=k($);for(let x=0;x<P.length;x+=1)P[x].l(Ue);Ue.forEach(_),we.forEach(_),ae=j(ne),z=m(ne,"DIV",{class:!0});var Pe=k(z);W=m(Pe,"LABEL",{class:!0});var Oe=k(W);be=R(Oe,"Filter "),se=R(Oe,ce),he=R(Oe,":"),Oe.forEach(_),de=j(Pe),Y=m(Pe,"DIV",{class:!0});var He=k(Y);for(let x=0;x<O.length;x+=1)O[x].l(He);He.forEach(_),Pe.forEach(_),ke=j(ne),K=m(ne,"DIV",{class:!0});var Le=k(K);Z=m(Le,"LABEL",{class:!0,"data-svelte-h":!0}),Be(Z)!=="svelte-8r6yw"&&(Z.textContent=Se),Ee=j(Le),ee=m(Le,"DIV",{class:!0});var Re=k(ee);for(let x=0;x<L.length;x+=1)L[x].l(Re);Re.forEach(_),Le.forEach(_),o=j(ne),f=m(ne,"DIV",{class:!0});var ve=k(f);b=m(ve,"LABEL",{class:!0});var Fe=k(b);M=R(Fe,"Filter "),B=R(Fe,D),w=R(Fe,":"),Fe.forEach(_),V=j(ve),S=m(ve,"INPUT",{type:!0,placeholder:!0,class:!0}),Q=j(ve),X=m(ve,"DIV",{class:!0});var ze=k(X);for(let x=0;x<F.length;x+=1)F[x].l(ze);qe=j(ze),A&&A.l(ze),ze.forEach(_),ve.forEach(_),ne.forEach(_),q.forEach(_),this.h()},h(){p(n,"class","methodology svelte-1lx8ury"),p(g,"class","reset svelte-1lx8ury"),p(N,"class","copy-config svelte-1lx8ury"),p(d,"class","header-buttons svelte-1lx8ury"),p(l,"class","header-info svelte-1lx8ury"),p(J,"class","svelte-1lx8ury"),p($,"class","options svelte-1lx8ury"),p(G,"class","category svelte-1lx8ury"),p(W,"class","svelte-1lx8ury"),p(Y,"class","options tiny svelte-1lx8ury"),p(z,"class","filtered-cluster-values svelte-1lx8ury"),p(Z,"class","svelte-1lx8ury"),p(ee,"class","options svelte-1lx8ury"),p(K,"class","category svelte-1lx8ury"),p(b,"class","svelte-1lx8ury"),p(S,"type","text"),p(S,"placeholder","Enter your query"),S.value=t[0],p(S,"class","svelte-1lx8ury"),p(X,"class","options tiny svelte-1lx8ury"),p(f,"class","filtered-entities svelte-1lx8ury"),p(C,"class","categories svelte-1lx8ury"),p(e,"class","svelte-1lx8ury")},m(r,q){te(r,e,q),a(e,l),a(l,n),a(n,c),a(l,h),a(l,d),a(d,g),a(d,i),a(d,N),a(e,I),a(e,C),a(C,G),a(G,J),a(G,y),a(G,$);for(let s=0;s<P.length;s+=1)P[s]&&P[s].m($,null);a(C,ae),a(C,z),a(z,W),a(W,be),a(W,se),a(W,he),a(z,de),a(z,Y);for(let s=0;s<O.length;s+=1)O[s]&&O[s].m(Y,null);a(C,ke),a(C,K),a(K,Z),a(K,Ee),a(K,ee);for(let s=0;s<L.length;s+=1)L[s]&&L[s].m(ee,null);a(C,o),a(C,f),a(f,b),a(b,M),a(b,B),a(b,w),a(f,V),a(f,S),a(f,Q),a(f,X);for(let s=0;s<F.length;s+=1)F[s]&&F[s].m(X,null);a(X,qe),A&&A.m(X,null),Ne||(Qe=[ue(g,"click",t[11]),ue(N,"click",t[12]),ue(S,"input",t[8])],Ne=!0)},p(r,q){if(q[0]&32&&oe(c,r[5]),q[0]&656){fe=re(r[7]);let s;for(s=0;s<fe.length;s+=1){const U=Ye(r,fe,s);P[s]?P[s].p(U,q):(P[s]=Ze(U),P[s].c(),P[s].m($,null))}for(;s<P.length;s+=1)P[s].d(1);P.length=fe.length}if(q[0]&16&&ce!==(ce=r[4].clusterBy+"")&&oe(se,ce),q[0]&17426){ge=re(r[1]);let s;for(s=0;s<ge.length;s+=1){const U=Xe(r,ge,s);O[s]?O[s].p(U,q):(O[s]=et(U),O[s].c(),O[s].m(Y,null))}for(;s<O.length;s+=1)O[s].d(1);O.length=ge.length}if(q[0]&592){_e=re(r[6]);let s;for(s=0;s<_e.length;s+=1){const U=Ke(r,_e,s);L[s]?L[s].p(U,q):(L[s]=tt(U),L[s].c(),L[s].m(ee,null))}for(;s<L.length;s+=1)L[s].d(1);L.length=_e.length}if(q[0]&16&&D!==(D=r[4].moveBy+"")&&oe(B,D),q[0]&1&&S.value!==r[0]&&(S.value=r[0]),q[0]&8204){pe=re(r[2].slice(0,50).sort(nt));let s;for(s=0;s<pe.length;s+=1){const U=We(r,pe,s);F[s]?F[s].p(U,q):(F[s]=lt(U),F[s].c(),F[s].m(X,qe))}for(;s<F.length;s+=1)F[s].d(1);F.length=pe.length}r[2].length>50?A?A.p(r,q):(A=st(r),A.c(),A.m(X,null)):A&&(A.d(1),A=null)},i:je,o:je,d(r){r&&_(e),De(P,r),De(O,r),De(L,r),De(F,r),A&&A.d(),Ne=!1,dt(Qe)}}}const Me=12,Vt=30,xe=12,St=30,nt=([t],[e])=>t.localeCompare(e);function qt(t,e,l){let n,c,h,d,g,u,i,N,E,I,C,G,J,le,y,$,ae;Ve(t,me,o=>l(3,le=o)),Ve(t,ye,o=>l(4,y=o)),Ve(t,$e,o=>l(19,$=o)),Ve(t,vt,o=>l(20,ae=o));let z=y.queryValue||"";function W(o){o.target.value.length>3&&(l(0,z=o.target.value),ye.update(f=>({...f,queryValue:z})))}const be=[],ce=[];function se(o,f){de(),me.set([]),o==="clusterBy"?ye.update(b=>({...b,clusterBy:f})):o==="moveBy"&&ye.update(b=>({...b,moveBy:f}))}function he(o){ye.update(D=>({...D,selectedClusterValue:o}));const f=z.toLowerCase(),b=y.queryCategory||"name",M=[];Object.entries(Ge($e)).forEach(([D,B])=>{const w=B.dataPoints.some(S=>{var Q;return((Q=S[y.clusterBy])==null?void 0:Q.toString())===o.toString()}),V=B.dataPoints.some(S=>{var Q;return(Q=S[b])==null?void 0:Q.toString().toLowerCase().includes(f)});w&&V&&(M.push(D),B.currentCategoryIndex=0,B.t=0,B.trail=[])}),me.set(M)}function de(){ye.update(o=>({...o,queryValue:"",selectedClusterValue:null})),l(0,z=""),me.set([])}function Y(){const o={title:"",description:"",methodology:"",media:!0,config:{clusterBy:y.clusterBy,moveBy:y.moveBy,selectedClusterValue:y.selectedClusterValue||"",queryValue:z,queryCategory:y.queryCategory||"name",speed:y.speed||3,stroke:y.stroke||1,loops:y.loopsToComplete||1,highlightedEntities:Ge(me)}},f=JSON.stringify(o,null,2);navigator.clipboard.writeText(f).then(()=>{alert("Config copied to clipboard!")}).catch(b=>{console.error("Could not copy text: ",b)})}function ke(o){return i===N?Me:Me+(o-i)*(Vt-Me)/(N-i)}function K(o){return C===G?xe:xe+(o-C)*(St-xe)/(G-C)}const Z=o=>se("clusterBy",o),Se=o=>he(o),Ee=o=>se("moveBy",o),ee=o=>me.set([o]);return t.$$.update=()=>{t.$$.dirty[0]&1048576&&l(17,h=ae.map(([o])=>o)),t.$$.dirty[0]&524305&&l(15,d=Object.entries($).filter(([o,f])=>{const b=y.selectedClusterValue?f.dataPoints.some(w=>{var V;return((V=w[y.clusterBy])==null?void 0:V.toString())===y.selectedClusterValue.toString()}):!0,M=z.toLowerCase(),D=y.queryCategory||"name",B=M.length>=3?f.dataPoints.some(w=>{var V;return(V=w[D])==null?void 0:V.toString().toLowerCase().includes(M)}):!0;return b&&B}).reduce((o,[f,b])=>(o[f]=b,o),{})),t.$$.dirty[0]&32768&&l(2,g=Object.entries(d).map(([o,f])=>[o,f.dataPoints.length])),t.$$.dirty[0]&4&&l(18,u=g.map(([o,f])=>f)),t.$$.dirty[0]&262144&&(i=u.length>0?Math.min(...u):0),t.$$.dirty[0]&262144&&(N=u.length>0?Math.max(...u):1),t.$$.dirty[0]&655368&&l(1,E=(()=>{const o=Object.values($),f=new Set(le),b=f.size>0;let M=h;const D=[];b&&(M=h.filter(B=>{for(let w=0;w<o.length;w++){const V=o[w];if(f.has(V.moveBy)&&V.categories.includes(B))return!0}return!1}));for(let B=0;B<M.length;B++){const w=M[B];let V=0;for(let S=0;S<o.length;S++){const Q=o[S];(!b||f.has(Q.moveBy))&&Q.categories.includes(w)&&V++}D.push([w,V])}return D})()),t.$$.dirty[0]&2&&l(16,I=E.map(([o,f])=>f)),t.$$.dirty[0]&65536&&(C=I.length>0?Math.min(...I):0),t.$$.dirty[0]&65536&&(G=I.length>0?Math.max(...I):1),t.$$.dirty[0]&32792&&l(5,J=(()=>{const o=y.clusterBy?`changes in ${y.clusterBy}`:"all clusters",f=y.moveBy?`grouped by ${y.moveBy}`:"without specific grouping",M=Object.values(d).reduce((S,Q)=>S+Q.dataPoints.length,0),D=y.selectedClusterValue?`filtered by the cluster value "${y.selectedClusterValue}"`:null,B=le.length>0?`highlighting ${le.length} entities matching the query`:null,w=[D,B].filter(Boolean).join(" and ");let V=`This visualization represents ${M} participants ${f}, with clusters reflecting ${o}.`;return w&&(V+=` The data is ${w}.`),V})())},l(7,n=kt.filter(o=>!be.includes(o))),l(6,c=Et.filter(o=>!ce.includes(o))),[z,E,g,le,y,J,c,n,W,se,he,de,Y,ke,K,d,I,h,u,$,ae,Z,Se,Ee,ee]}class It extends ot{constructor(e){super(),it(this,e,qt,Bt,rt,{},null,[-1,-1])}}function wt(t){let e,l="Loading...";return{c(){e=v("p"),e.textContent=l,this.h()},l(n){e=m(n,"P",{class:!0,"data-svelte-h":!0}),Be(e)!=="svelte-qdsr2u"&&(e.textContent=l),this.h()},h(){p(e,"class","svelte-13tgnqv")},m(n,c){te(n,e,c)},i:je,o:je,d(n){n&&_(e)}}}function Pt(t){let e,l,n;return l=new bt({}),{c(){e=v("div"),at(l.$$.fragment),this.h()},l(c){e=m(c,"DIV",{class:!0});var h=k(e);ct(l.$$.fragment,h),h.forEach(_),this.h()},h(){p(e,"class","svelte-13tgnqv")},m(c,h){te(c,e,h),ut(l,e,null),n=!0},i(c){n||(Te(l.$$.fragment,c),n=!0)},o(c){Ae(l.$$.fragment,c),n=!1},d(c){c&&_(e),ht(l)}}}function Ot(t){let e,l,n,c,h,d,g;const u=[Pt,wt],i=[];function N(E,I){return E[0].length>0?0:1}return l=N(t),n=i[l]=u[l](t),d=new It({}),{c(){e=v("main"),n.c(),c=T(),h=v("div"),at(d.$$.fragment),this.h()},l(E){e=m(E,"MAIN",{});var I=k(e);n.l(I),c=j(I),h=m(I,"DIV",{class:!0});var C=k(h);ct(d.$$.fragment,C),C.forEach(_),I.forEach(_),this.h()},h(){p(h,"class","svelte-13tgnqv")},m(E,I){te(E,e,I),i[l].m(e,null),a(e,c),a(e,h),ut(d,h,null),g=!0},p(E,[I]){let C=l;l=N(E),l!==C&&(_t(),Ae(i[C],1,1,()=>{i[C]=null}),gt(),n=i[l],n||(n=i[l]=u[l](E),n.c()),Te(n,1),n.m(e,c))},i(E){g||(Te(n),Te(d.$$.fragment,E),g=!0)},o(E){Ae(n),Ae(d.$$.fragment,E),g=!1},d(E){E&&_(e),i[l].d(),ht(d)}}}function Lt(t,e,l){let n;return Ve(t,Je,c=>l(0,n=c)),ft(async()=>{const h=(await Ct(pt+"/data/update-until-2022/data.tsv")).map(d=>{const g={};for(const[u,i]of Object.entries(d))g[u]=i!=null&&i.trim()?i:"?";return g});Je.set(h),mt.set(window.innerWidth),yt.set(600)}),[n]}class Mt extends ot{constructor(e){super(),it(this,e,Lt,Ot,rt,{})}}export{Mt as component};
